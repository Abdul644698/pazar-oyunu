<!DOCTYPE html>
<html lang="az">
<head>
<!-- Firebase scripts -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
  // Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyCCj0jBFuP1bKjOXB_-WwTMOMcJ5BSwT_I",
    authDomain: "pazar-oyun.firebaseapp.com",
    databaseURL: "https://pazar-oyun-default-rtdb.firebaseio.com",
    projectId: "pazar-oyun",
    storageBucket: "pazar-oyun.firebasestorage.app",
    messagingSenderId: "2500103464",
    appId: "1:2500103464:web:641cb188ee8de73293541d",
    measurementId: "G-CJM1MC5ZSJ"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
</script>

<meta charset="UTF-8">
<title>Bazar Oyunu</title>
<style>
body{margin:0;font-family:Arial;background:#0b132b;color:white}
#top{background:#000a;padding:10px;display:flex;justify-content:space-between}
.box{background:#1c2541;margin:15px;padding:15px;border-radius:10px}
button,input,select{padding:7px;margin:4px;border-radius:5px;border:none}
button{background:#5bc0be;color:black;cursor:pointer}
.item{background:#3a506b;padding:8px;margin:6px 0;border-radius:5px;display:flex;justify-content:space-between;align-items:center}
.admin{background:#fca311;color:black}
input.priceInput{width:60px;margin-left:10px}
</style>
</head>
<body>

<div id="top">
<span id="userInfo">GiriÅŸ yoxdur</span>
<span>Pul: <b><span id="userMoney">0</span> AZN</b></span>
</div>

<div class="box" id="loginBox">
<h2>GiriÅŸ / Qeydiyyat</h2>
<input id="username" placeholder="Ä°stifadÉ™Ã§i adÄ±"><br>
<input id="password" type="password" placeholder="ÅifrÉ™"><br>
<button onclick="login()">Daxil ol</button>
</div>

<div class="box" id="menu" style="display:none">
<button onclick="show('wholesale')">ğŸ­ ToptancÄ±</button>
<button onclick="show('myMarket')">ğŸª Ã–z BazarÄ±m</button>
<button onclick="show('globalMarket')">ğŸŒ BazardakÄ± mallar</button>
<button onclick="show('sendMoneyBox')">ğŸ’¸ Pul GÃ¶ndÉ™r</button>
<button onclick="show('adminPanel')">ğŸ‘‘ Admin Panel</button>
<button onclick="logout()">Ã‡Ä±xÄ±ÅŸ</button>
</div>

<div class="box" id="wholesale" style="display:none">
<h3>ğŸ­ ToptancÄ±</h3>
<div id="wholesaleItems"></div>
</div>

<div class="box" id="myMarket" style="display:none">
<h3>Ã–z BazarÄ±n</h3>
<div id="myItems"></div>
</div>

<div class="box" id="globalMarket" style="display:none">
<h3>ğŸŒ BazardakÄ± Mallar</h3>
<div id="globalItems"></div>
</div>

<div class="box" id="sendMoneyBox" style="display:none">
<h3>ğŸ’¸ Pul GÃ¶ndÉ™r</h3>
<select id="sendUser"></select>
<input type="number" id="sendAmount" placeholder="MÉ™blÉ™ÄŸ">
<button onclick="sendMoney()">GÃ¶ndÉ™r</button>
</div>

<div class="box admin" id="adminPanel" style="display:none">
<h3>ğŸ‘‘ Admin Panel</h3>
<p>Admin pulu: <b id="adminMoneyDisplay"></b> AZN</p>

<h4>Topdan mallar É™lavÉ™ et</h4>
<input id="wName" placeholder="Mal adÄ±">
<input id="wPrice" type="number" placeholder="QiymÉ™t">
<button onclick="addWholesale()">ÆlavÉ™ et</button>
<div id="adminWholesale"></div>
</div>

<script>
let users = JSON.parse(localStorage.getItem("users")) || {};
let wholesale = JSON.parse(localStorage.getItem("wholesale")) || [];
let market = JSON.parse(localStorage.getItem("market")) || [];
let admin = localStorage.getItem("admin") || null;
let currentUser = localStorage.getItem("currentUser") || null;
let adminMoney = Number(localStorage.getItem("adminMoney")) || 999999999;

function save(){
 localStorage.setItem("users",JSON.stringify(users));
 localStorage.setItem("wholesale",JSON.stringify(wholesale));
 localStorage.setItem("market",JSON.stringify(market));
 localStorage.setItem("admin",admin);
 localStorage.setItem("currentUser",currentUser);
 localStorage.setItem("adminMoney",adminMoney);
}

function login(){
 let u=username.value.trim();
 let p=password.value;
 if(!u||!p)return alert("BoÅŸ olmaz");

 if(!admin){
   admin=u;
   users[u]={password:p,money:adminMoney,stock:[]};
 } else if(!users[u]){
   users[u]={password:p,money:10,stock:[]};
 } else if(users[u].password!==p){
   return alert("ÅifrÉ™ sÉ™hvdir");
 }
 currentUser=u;
 save(); start();
}

function start(){
 loginBox.style.display="none";
 menu.style.display="block";
 userInfo.innerText=currentUser+(currentUser===admin?" (ADMIN)":"");
 updateMoney(); loadWholesale(); loadMy(); loadMarket(); loadSendUsers(); loadAdminPanel();
 show("wholesale");
}

function updateMoney(){
 userMoney.innerText = currentUser===admin?adminMoney:users[currentUser].money;
}

function show(id){
 document.querySelectorAll(".box").forEach(b=>b.style.display="none");
 menu.style.display="block";
 document.getElementById(id).style.display="block";
}

function loadWholesale(){
 wholesaleItems.innerHTML="";
 wholesale.forEach((i,idx)=>{
   if(currentUser!==admin)
     wholesaleItems.innerHTML+=`<div class="item">${i.name} | ${i.price} AZN <button onclick="buyWholesale(${idx})">Al</button></div>`;
 });
}

function buyWholesale(idx){
 let item=wholesale[idx];
 if(users[currentUser].money<item.price)return alert("Pul Ã§atmÄ±r");
 users[currentUser].money-=item.price;
 users[currentUser].stock.push(item);
 wholesale.splice(idx,1); // ğŸ‘ˆ ALINAN KÄ°MÄ° SÄ°LÄ°NÄ°R
 save(); loadWholesale(); loadMy(); updateMoney();
}

function loadMy(){
 myItems.innerHTML="";
 users[currentUser].stock.forEach((i,idx)=>{
   myItems.innerHTML+=`<div class="item">${i.name}
   <input class="priceInput" id="p${idx}" placeholder="QiymÉ™t">
   <button onclick="sellItem(${idx})">Sat</button></div>`;
 });
}

function sellItem(idx){
 let price=Number(document.getElementById("p"+idx).value);
 if(price<=0)return;
 let item=users[currentUser].stock.splice(idx,1)[0];
 market.push({name:item.name,price,seller:currentUser});
 save(); loadMy(); loadMarket();
}

function loadMarket(){
 globalItems.innerHTML="";
 market.forEach((i,idx)=>{
   globalItems.innerHTML+=`<div class="item">${i.name} | ${i.price} AZN <button onclick="buyMarket(${idx})">Al</button></div>`;
 });
}

function buyMarket(idx){
 let i=market[idx];
 if(users[currentUser].money<i.price)return;
 users[currentUser].money-=i.price;
 users[i.seller].money+=i.price;
 users[currentUser].stock.push(i);
 market.splice(idx,1);
 save(); loadMarket(); updateMoney();
}

function loadSendUsers(){
 sendUser.innerHTML="";
 Object.keys(users).forEach(u=>{ if(u!==currentUser) sendUser.innerHTML+=`<option>${u}</option>`;});
}

function sendMoney(){
 let u=sendUser.value, a=Number(sendAmount.value);
 if(a<=0)return;
 users[currentUser].money-=a;
 users[u].money+=a;
 save(); updateMoney();
}

function addWholesale(){
 if(currentUser!==admin)return; // ğŸ‘ˆ YALNIZ ADMIN
 wholesale.push({name:wName.value,price:Number(wPrice.value)});
 save(); loadWholesale(); loadAdminPanel();
}

function loadAdminPanel(){
 if(currentUser!==admin)return;
 adminWholesale.innerHTML="";
 wholesale.forEach((i,idx)=>{
   adminWholesale.innerHTML+=`<div class="item">${i.name} ${i.price} AZN</div>`;
 });
 adminMoneyDisplay.innerText=adminMoney;
}
</script>
</body>
</html>
